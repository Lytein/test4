@page "/store"
@using StoreManagementBlazorApp.Services
@using StoreManagementBlazorApp.Entities
@inject StoreService Store
@inject NavigationManager Navigation
@rendermode InteractiveServer
<div class="store-page">
<h1 class="mb-4">Our Products</h1>
<p class="text-muted mb-4">Discover amazing products at great prices</p>

<!-- Search + Filter -->
<div class="mb-4 d-flex flex-column flex-md-row gap-2">
    <input placeholder="Search products..." @bind="SearchQuery" class="form-control flex-grow-1 mb-2 mb-md-0" />
    <select class="form-select w-md-auto" @bind="FilterCategory">
        <option value="all">All Categories</option>
        @foreach (var cat in Categories)
        {
            <option value="@cat">@cat</option>
        }
    </select>
</div>

<!-- Products Grid -->
<div class="row g-3">
    @foreach (var product in FilteredProducts)
    {
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 shadow-sm">
                <!-- Image -->
                <div class="position-relative" style="aspect-ratio:4/3;">
                    <img src="@(!string.IsNullOrEmpty(product.Image) ? product.Image : "/images/phone.jpg")"
                         class="card-img-top object-fit-cover h-100 w-100" />
                </div>
                <!-- Product Info -->
                <div class="card-body d-flex flex-column">
                    <small class="text-muted">@product.Category</small>
                    <h5 class="card-title text-truncate mt-1">@product.Name</h5>
                    <p class="card-text text-truncate-2-lines text-muted mb-2">@product.unit</p>
                    <p class="fw-bold mt-auto mb-2">@product.Price.ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN"))</p>

                    <!-- Actions -->
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary flex-grow-1 btn-sm"
                                @onclick='() => Navigation.NavigateTo($"/store/products/{product.Id}")'>
                            View Details
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" @onclick="() => Store.AddToCart(product, 1)">
                            🛒
                        </button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

    @code {
        private string SearchQuery = "";
        private string FilterCategory = "all";

        private List<string> Categories = new()
        {
        "Electronics", "Fashion", "Home", "Sports", "Books"
        };

        private IEnumerable<Product> FilteredProducts =>
        Store.Products.Where(p =>
        (FilterCategory == "all" || p.Category == FilterCategory) &&
        (string.IsNullOrWhiteSpace(SearchQuery) ||
        p.Name.Contains(SearchQuery, StringComparison.OrdinalIgnoreCase))
        );

        protected override async Task OnInitializedAsync()
        {
            await Store.LoadProductsAsync();
            Console.WriteLine($"UI products: {Store.Products.Count}");
        }
    }


</div>